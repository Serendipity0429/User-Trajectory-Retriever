{% extends "base.html" %}
{% block title %} Answer Submission {% endblock %}
{% block content_title %} Answer Submission {% endblock %}
{% block content %}
    <div class="row text-center">
        <h3>
            Please submit the answer to the questions below
        </h3>
    </div>
    <div class="row">
        <div class="col-xs-offset-1 col-xs-10">
            <details>
                <summary class="col-xs-12 list_header">
                    Trajectories of this task
                </summary>
                <div class="col-xs-offset-1 col-xs-10" id="trajectories">
                    {% for webpage in webpages %}
                        <div class="col-xs-12 list_row webpage-wrapper">
                            {#                style="padding: 3% 0 3% 0;border-bottom: 1px solid #cccccc;">#}
                            <p style="font-size: 20px">Webpage {{ forloop.counter }}:&ensp;<a href="{{ webpage.url }}"
                                                                                              target="_blank">{{ webpage.title }}</a>
                            </p>
                            <!-- create a div to store the rrweb player -->
                            <div class="rrweb-player-wrapper" id="rrweb-player-{{ webpage.id }}"></div>
                            <script>
                                var rrweb_events_{{ webpage.id }} = {{ webpage.rrweb_events | safe }};
                                // create a rrweb player
                                const player_{{ webpage.id }} = new rrwebPlayer({
                                    target: document.getElementById(`rrweb-player-{{ webpage.id }}`),
                                    props: {
                                        events: rrweb_events_{{ webpage.id }},
                                        autoPlay: false,
                                        width: 800,
                                        height: 377,
                                    },
                                });
                            </script>
                        </div>
                    {% endfor %}
                </div>
            </details>
        </div>
        <div class="col-xs-offset-1 col-xs-10">
            <div class="col-xs-12 list_header">
                Your answer
            </div>
            <form class="col-xs-12" id="query-form" action="" method="post" onsubmit="validateForm()"
                  enctype='multipart/form-data'>
                {% csrf_token %}
                <div class="col-xs-12 sheet">
                    <div class="question-wrapper">
                        <span class="col-xs-12 list_row"><b>Question</b>:</span>
                        <div class="static-task-info">{{ question }}</div>
                    </div>
                    <div class="question-wrapper">
                        <label for="answer" class="col-xs-12 list_row"> <b>Your Answer</b>:</label>
                        <div><textarea class="col-xs-12 list_row" id="answer" name="answer" rows="5" required></textarea>
                        </div>
                    </div>
                </div>
            </form>
            <div class="col-xs-12">
                <div id="query-btn" class="col-xs-6 submit-btn btn btn-block btn-lg btn-primary">
                    Submit Answer
                </div>
            </div>
            <div class="col-xs-12">
                <div id="cancel-btn" class="col-xs-6 submit-btn btn btn-block btn-lg btn-primary cancel-button">
                    Cancel
                </div>
            </div>
        </div>
        <script>
            function validateForm() {

            }
        </script>
        <script type="application/x-javascript">
            $(function () {
                $('#query-btn').click(
                    function () {
                        let answer = $("[name='answer']");

                        if (answer.val() === '') {
                            alert('Please fill in the answer!');
                            answer.focus();
                            return
                        }

                        if (confirm("Are you sure to submit all annotations?")) {
                            $('#query-form').submit();
                        }

                    }
                );
                $('#cancel-btn').click(
                    function () {
                        if (confirm("Are you sure to abort the task submission?")) {
                            window.close();
                        }
                    }
                );
            });
        </script>
    </div>

{% endblock %}