{% extends "base.html" %}
{% block title %}Sign Up{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg border-0 rounded-lg mt-5">
                <div class="card-header text-center py-4 bg-primary text-white">
                    <h3 class="fw-light my-2">Create a New Account</h3>
                </div>
                <div class="card-body p-5">
                    <form id="signup_form" name="signup_form" action="" method="POST" novalidate>
                        {% csrf_token %}

                        <h5 class="mb-4"><i class="bi bi-person-badge-fill me-2"></i>Account Information</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="text" name="username" class="form-control" id="id_username" placeholder="Username">
                                    <label for="id_username"><i class="bi bi-person-fill me-2"></i>Username</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="text" name="name" class="form-control" id="id_name" placeholder="Name">
                                    <label for="id_name"><i class="bi bi-person-circle me-2"></i>Name</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="password" name="password" class="form-control" id="id_password" placeholder="Password">
                                    <label for="id_password"><i class="bi bi-key-fill me-2"></i>Password</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="password" name="password_retype" class="form-control" id="id_password_retype" placeholder="Retype Password">
                                    <label for="id_password_retype"><i class="bi bi-key me-2"></i>Retype Password</label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12 text-center">
                                <div class="form-text text-muted small">
                                    *Your password is securely encrypted with one-way hashing and cannot be viewed by anyone, including us.
                                </div>
                            </div>
                        </div>

                        <hr class="my-4">

                        <h5 class="mb-4"><i class="bi bi-file-person-fill me-2"></i>Personal Details</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="email" name="email" class="form-control" id="id_email" placeholder="Email">
                                    <label for="id_email"><i class="bi bi-envelope-fill me-2"></i>Email</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="text" name="phone" class="form-control" id="id_phone" placeholder="Phone">
                                    <label for="id_phone"><i class="bi bi-telephone-fill me-2"></i>Phone</label>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="form-floating">
                                    <select name="gender" class="form-select" id="id_gender">
                                        {% for value, text in form.fields.gender.choices %}
                                            <option value="{{ value }}">{{ text }}</option>
                                        {% endfor %}
                                    </select>
                                    <label for="id_gender"><i class="bi bi-gender-ambiguous me-2"></i>Gender</label>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="form-floating">
                                    <input type="number" name="age" class="form-control" id="id_age">
                                    <label for="id_age"><i class="bi bi-calendar-event-fill me-2"></i>Age</label>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="form-floating">
                                    <select name="occupation" class="form-select" id="id_occupation">
                                        {% for value, text in form.fields.occupation.choices %}
                                            <option value="{{ value }}">{{ text }}</option>
                                        {% endfor %}
                                    </select>
                                    <label for="id_occupation"><i class="bi bi-briefcase-fill me-2"></i>Occupation</label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <select name="education" class="form-select" id="id_education">
                                        {% for value, text in form.fields.education.choices %}
                                            <option value="{{ value }}">{{ text }}</option>
                                        {% endfor %}
                                    </select>
                                    <label for="id_education"><i class="bi bi-book-fill me-2"></i>Education Level</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="text" name="field_of_expertise" class="form-control" id="id_field_of_expertise">
                                    <label for="id_field_of_expertise"><i class="bi bi-lightbulb-fill me-2"></i>Field of Expertise</label>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4">

                        <h5 class="mb-4"><i class="bi bi-robot me-2"></i>Large Language Model Usage</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <select name="llm_frequency" class="form-select" id="id_llm_frequency">
                                        {% for value, text in form.fields.llm_frequency.choices %}
                                            <option value="{{ value }}">{{ text }}</option>
                                        {% endfor %}
                                    </select>
                                    <label for="id_llm_frequency">How often do you use LLMs?</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <select name="llm_history" class="form-select" id="id_llm_history">
                                        {% for value, text in form.fields.llm_history.choices %}
                                            <option value="{{ value }}">{{ text }}</option>
                                        {% endfor %}
                                    </select>
                                    <label for="id_llm_history">How long have you been using LLMs?</label>
                                </div>
                            </div>
                        </div>

                        <div id="error-container" class="alert alert-danger d-flex align-items-center mt-4 {% if not error_message %}d-none{% endif %}" role="alert">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            <div id="error-text">
                                {% if error_message %}{{ error_message }}{% endif %}
                            </div>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary btn-lg"><i class="bi bi-person-plus-fill me-2"></i>Sign Up</button>
                        </div>
                    </form>
                </div>
                <div class="card-footer text-center py-3">
                    <div class="small"><a href="{% url 'user_system:login' %}" class="btn btn-link">Have an account? Go to login</a></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('signup_form');
    const errorContainer = document.getElementById('error-container');
    const errorText = document.getElementById('error-text');
    const inputs = form.querySelectorAll('input:not([type="hidden"]), select');

    // Function to update a single input's validity
    const updateInputValidity = (input) => {
        if (!input.value || input.value.trim() === '') {
            input.classList.add('is-invalid');
            return false;
        } else {
            input.classList.remove('is-invalid');
            return true;
        }
    };

    // Add event listeners to each input to validate on change
    inputs.forEach(input => {
        input.addEventListener('input', () => {
            updateInputValidity(input);
        });
        // For select elements, 'change' event is more appropriate
        if (input.tagName.toLowerCase() === 'select') {
            input.addEventListener('change', () => {
                updateInputValidity(input);
            });
        }
    });

    if (form) {
        form.addEventListener('submit', function(event) {
            let isFormValid = true;
            
            // Check all inputs on submit
            inputs.forEach(input => {
                if (!updateInputValidity(input)) {
                    isFormValid = false;
                }
            });

            if (!isFormValid) {
                event.preventDefault();
                if (errorText) {
                    errorText.textContent = 'Please fill in all required fields.';
                }
                if (errorContainer) {
                    errorContainer.classList.remove('d-none');
                }
            } else {
                if (errorContainer) {
                    errorContainer.classList.add('d-none');
                }
            }
        });
    }
});
</script>
{% endblock %}